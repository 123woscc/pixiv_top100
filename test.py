import requests
import os
import collections
import tqdm
from concurrent import futures


def save_img(img, filename):
    path = os.path.join('./full', filename)
    with open(path, 'wb') as f:
        f.write(img)


def get_img(url):
    headers = {
        'Referer': 'https://www.pixiv.net/',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36'
    }
    resp = requests.get(url, headers=headers)
    return resp.content


def download_one(url):
    image = get_img(url)
    file_name = url.split('/')[-1]
    save_img(image, file_name)
    return url


def download_many(urls):
    # counter = collections.Counter()
    with futures.ThreadPoolExecutor(max_workers=30) as executor:
        to_do_map = {}
        for url in sorted(urls):
            future = executor.submit(download_one, url)
            to_do_map[future] = url
        done_iter = futures.as_completed(to_do_map)
        done_iter = tqdm.tqdm(done_iter, total=len(urls), unit_scale=True)
        for future in done_iter:
            try:
                res = future.result()
            except requests.exceptions.HTTPError as exc:
                error_msg = 'HTTP {res.status_code} - {res.resaon}'
                error_msg = error_msg.format(res=exc.response)
            else:
                error_msg = ''
            if error_msg:
                print('*** Error for {}: {}'.format(error_msg, url))


def main():
    urls = ['https://i.pximg.net/img-original/img/2017/08/22/06/13/55/64556479_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/30/01/64553156_p0.png', 'https://i.pximg.net/img-original/img/2017/08/23/00/01/54/64568682_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/01/54/64568682_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/11/07/36/64555475_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/02/40/53/64555294_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/02/40/53/64555294_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/13/32/10/64559312_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/04/40/64552490_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/02/32/39/64555217_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/09/57/55/64557520_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/17/52/54/64545370_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/09/19/38/64557313_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/08/34/64552598_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/04/64535053_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/02/26/64535199_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/00/18/64552335_p0.png', 'https://i.pximg.net/img-original/img/2017/08/23/09/12/56/64568606_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/09/12/56/64568606_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/01/11/42/64554044_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/02/38/54/64555277_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/02/38/54/64555277_p1.png', 'https://i.pximg.net/img-original/img/2017/08/22/02/38/54/64555277_p2.png', 'https://i.pximg.net/img-original/img/2017/08/22/00/05/32/64552455_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/01/08/52/64570224_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/01/08/52/64570224_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/01/08/52/64570224_p2.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/03/57/64552462_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/13/28/23/64542465_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/01/64535027_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/29/26/64553145_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/11/58/31/64548934_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/12/46/36/64558879_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/14/38/06/64559878_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/23/13/23/64567434_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/09/23/11/64540430_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/07/27/41/64556794_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/07/27/41/64556794_p1.png', 'https://i.pximg.net/img-original/img/2017/08/22/07/27/41/64556794_p2.png', 'https://i.pximg.net/img-original/img/2017/08/22/07/27/41/64556794_p3.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/03/14/64535228_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/20/43/18/64564377_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/01/06/38/64536917_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/15/48/31/64560609_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/19/39/50/64546790_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/09/46/30/64557454_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/18/05/11/64578129_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/02/64535042_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/15/18/20/64560300_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/13/53/49/64542718_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/46/01/64569791_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/46/01/64569791_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/00/03/64568591_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/18/03/15/64545518_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/03/19/56/64555641_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/16/29/43/64561042_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/00/02/50/64552429_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/05/29/26/64556301_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/10/64535093_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/10/64535093_p1.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/10/64535093_p2.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/10/64535093_p3.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/10/64535093_p4.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/10/64535093_p5.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/10/64535093_p6.png', 'https://i.pximg.net/img-original/img/2017/08/21/02/40/32/64538257_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/20/37/52/64564281_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/00/38/19/64553376_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/00/38/19/64553376_p1.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p1.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p2.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p3.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p4.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p5.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p6.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p7.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p8.png', 'https://i.pximg.net/img-original/img/2017/08/22/22/51/16/64566306_p9.png', 'https://i.pximg.net/img-original/img/2017/08/23/12/19/37/64574633_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/16/36/43/64561118_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/00/01/64568561_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/10/00/01/64557532_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/19/01/27/64560030_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/19/01/27/64560030_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/00/02/64568585_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/00/03/64552288_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/09/57/16/64557515_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/14/43/20/64559934_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/14/43/20/64559934_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/11/49/64552684_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/16/49/15/64544599_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/16/29/49/64561045_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/16/29/49/64561045_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/16/29/49/64561045_p2.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/16/29/49/64561045_p3.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/16/29/49/64561045_p4.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/17/38/05/64561804_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/00/58/03/64553774_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/02/27/25/64538096_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/02/27/25/64538096_p1.png', 'https://i.pximg.net/img-original/img/2017/08/21/02/27/25/64538096_p2.png', 'https://i.pximg.net/img-original/img/2017/08/21/02/27/25/64538096_p3.png', 'https://i.pximg.net/img-original/img/2017/08/21/02/27/25/64538096_p4.png', 'https://i.pximg.net/img-original/img/2017/08/21/02/27/25/64538096_p5.png', 'https://i.pximg.net/img-original/img/2017/08/21/12/10/11/64541755_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/21/03/57/64564725_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/43/64569168_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/43/64569168_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/43/64569168_p2.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/43/64569168_p3.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/43/64569168_p4.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/43/64569168_p5.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/12/14/18/64541787_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/20/09/13/64563852_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/42/64535134_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/00/42/64535134_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/10/12/37/64557607_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/08/31/04/64557064_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/08/31/04/64557064_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/21/38/43/64565426_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/22/21/38/43/64565426_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/26/64569161_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/18/26/64569161_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/01/49/19/64537645_p0.png', 'https://i.pximg.net/img-original/img/2017/08/23/00/01/09/64568662_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/23/16/23/64567512_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p1.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p2.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p3.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p4.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p5.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p6.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p7.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p8.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p9.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p10.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p11.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p12.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p13.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p14.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p15.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p16.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p17.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p18.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p19.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p20.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p21.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p22.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p23.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p24.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p25.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p26.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p27.png', 'https://i.pximg.net/img-original/img/2017/08/21/01/16/10/64537110_p28.png', 'https://i.pximg.net/img-original/img/2017/08/22/19/50/18/64563589_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/22/49/50/64550487_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p1.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p2.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p3.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p4.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p5.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p6.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p7.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p8.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p9.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p10.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p11.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p12.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p13.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p14.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p15.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p16.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p17.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p18.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p19.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p20.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p21.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p22.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p23.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p24.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p25.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p26.png', 'https://i.pximg.net/img-original/img/2017/08/21/03/04/55/64538499_p27.png', 'https://i.pximg.net/img-original/img/2017/08/22/23/06/06/64567260_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/01/37/30/64537459_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/29/51/64569440_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/29/51/64569440_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/18/25/50/64545811_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/52/02/64536597_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/52/02/64536597_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/52/02/64536597_p2.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/52/02/64536597_p3.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/00/52/02/64536597_p4.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/21/54/45/64581628_p0.png', 'https://i.pximg.net/img-original/img/2017/08/22/18/51/01/64562760_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/00/04/28/64535276_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/19/16/45/64546503_p0.png', 'https://i.pximg.net/img-original/img/2017/08/21/19/48/42/64546944_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/21/01/02/17/64536817_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/00/06/64568611_p0.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/00/06/64568611_p1.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/00/06/64568611_p2.jpg', 'https://i.pximg.net/img-original/img/2017/08/23/00/00/06/64568611_p3.jpg']
    download_many(urls)


if __name__ == '__main__':
    main()
